# Copyright (c) 2006, Berges Allmenndigitale Rådgivningstjeneste
# All rights reserved.
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
#
#     * Redistributions of source code must retain the above copyright
#       notice, this list of conditions and the following disclaimer.
#     * Redistributions in binary form must reproduce the above copyright
#       notice, this list of conditions and the following disclaimer in the
#       documentation and/or other materials provided with the distribution.
#     * Neither the name of Berges Allmenndigitale Rådgivningstjeneste nor the
#       names of its contributors may be used to endorse or promote products
#       derived from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY BERGES AND CONTRIBUTORS ``AS IS'' AND ANY
# EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
# DISCLAIMED. IN NO EVENT SHALL BERGES AND CONTRIBUTORS BE LIABLE FOR ANY
# DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
# (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
# LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
# ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

JSAPI_FLAGS   = @JSAPI_FLAGS@
prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
libdir=@libdir@
mandir=@mandir@
version=@PACKAGE_VERSION@

all:
	$(MAKE) -C js/src -f Makefile.ref Linux_All_OPT.OBJ/libjs.so BUILD_OPT=1 XCFLAGS="$(XCFLAGS)"
	cp js/src/Linux_All_OPT.OBJ/jsautocfg.h js/src
	mkdir global/JSEXT1/C/0-include || echo 0-include exists
	cp js/src/*.h js/src/*.tbl js/src/*.msg global/JSEXT1/C/0-include
	$(MAKE) -C libjsext XCFLAGS="$(XCFLAGS)"
	$(MAKE) -C global XCFLAGS="$(XCFLAGS)"

clean:
	$(MAKE) -C global clean
	$(MAKE) -C js/src -f Makefile.ref clean
	rm -rf js/src/Linux_All_OPT.OBJ
	rm -f js/src/jsautocfg.h
	rm -rf global/JSEXT1/C/0-include
	$(MAKE) -C libjsext clean

install:
	install -D js/src/Linux_All_OPT.OBJ/libjs.so $(DESTDIR)$(libdir)/libjs.so
	install -D man/jsext.1 $(DESTDIR)$(mandir)/man1/jsext.1
	$(MAKE) -C libjsext install DESTDIR=$(DESTDIR)
	$(MAKE) -C global install DESTDIR=$(DESTDIR)

distclean:	clean
	rm -f Makefile config.status config.log *~ libjsext/Makefile global/Makefile global/JSEXT1/Makefile
	rm -rf autom4te.cache
